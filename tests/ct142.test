package require tcltest
source constcl.tcl
namespace import -force tcltest::*

test cons-14.1 {Scheme cookbook, due to Jakub T. Jankiewicz} -body {
    pew "(define (adjoin x a)
  (if (member x a)
      a
      (cons x a)))"
    pew "(adjoin 'x '(a b c))"
} -output "(x a b c)\n"

test cons-14.2 {Scheme cookbook, due to Nils M Holm} -body {
    pew "(adjoin 'c '(a b c))"
} -output "(a b c)\n"

test cons-14.3 {Scheme cookbook, due to Jakub T. Jankiewicz} -body {
    pew "(define (list-index fn list)
  (let iter ((list list) (index 0))
    (if (null? list)
        -1
        (let ((item (car list)))
          (if (fn item)
              index
              (iter (cdr list) (+ index 1)))))))"
    pew "(define (>10 x) (> x 10))"
    pew "(list-index >10 '(1 2 3 4 10 11 12 13 14))"
} -output "5\n"

test cons-14.4 {Scheme cookbook, due to Jakub T. Jankiewicz} -body {
    pew "(define (take lst n)
  (let loop ((result '()) (i n) (lst lst))
    (if (or (null? lst) (<= i 0))
        (reverse result)
        (loop (cons (car lst) result) (- i 1) (cdr lst)))))"
    pew "(define (sublist-map n fn lst)
  (let loop ((lst lst) (result '()))
    (if (< (length lst) n)
        (reverse result)
        (let ((next-list (take lst n)))
          (loop (cdr lst) (cons (apply fn next-list) result))))))"
    pew "(sublist-map 2 < '(1 2 3 4))"
} -output "(#t #t #t)\n"

test cons-14.5 {Scheme cookbook, due to Jakub T. Jankiewicz} -body {
    pew "(define (remove fn lst)
  (let loop ((lst lst) (result '()))
    (if (null? lst)
        (reverse result)
        (let ((item (car lst)))
          (loop (cdr lst)
                (if (fn item) result (cons item result)))))))"
    pew "(remove >10 '(1 2 3 4 10 11 12 13 14))"
} -output "(1 2 3 4 10)\n"

test cons-14.6 {Scheme cookbook, due to Lassi Kortela} -body {
    pew {(define (group n lst)
  (if (< n 1)
      (error "group: n must be positive")
      (let loop ((lst lst) (m n) (g '()) (gs '()))
        (cond ((and (null? lst) (null? g))
               (reverse gs))
              ((or (null? lst) (zero? m))
               (loop lst n '() (cons (reverse g) gs)))
              (else
               (loop (cdr lst) (- m 1) (cons (car lst) g) gs))))))}
    pew "(group 3 (in-range 10))"
} -output "((0 1 2) (3 4 5) (6 7 8) (9))\n"

test cons-14.7 {Scheme cookbook, due to Lassi Kortela} -body {
    pew {(define (group-by f lst)
  (if (null? lst) '()
      (let ((first (car lst)))
        (let loop ((lst (cdr lst))
                   (key (f first))
                   (group (list first))
                   (groups '()))
          (if (null? lst)
              (reverse (cons (reverse group) groups))
              (let ((newkey (f (car lst))))
                (if (equal? key newkey)
                    (loop (cdr lst) key
                          (cons (car lst) group)
                          groups)
                    (loop (cdr lst) newkey
                          (list (car lst))
                          (cons (reverse group) groups)))))))))}
    pew "(group-by odd? '(1 3 5 2 1 6 4 1 7))"
} -output "((1 3 5) (2) (1) (6 4) (1 7))\n"


cleanupTests
return
