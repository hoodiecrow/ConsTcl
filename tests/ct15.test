package require tcltest
source constcl.tcl
namespace import -force tcltest::*

test eval-8.0 {define} -body {
    w [::constcl::rewrite-define [p {(define (foo a b) (+ a b) (* a b))}] ::constcl::global_env]
} -output "(define foo (lambda (a b) (+ a b) (* a b)))\n"

test eval-8.1 {define} -body {
    w [::constcl::rewrite-define [p "(define (fib n) (if (< n 2) 1 (+ (fib (- n 1)) (fib (- n 2)))))"] ::constcl::global_env]
} -output "(define fib (lambda (n) (if (< n 2) 1 (+ (fib (- n 1)) (fib (- n 2))))))\n"

test eval-8.2 {define} -body {
    w [::constcl::rewrite-define [p "(define (f) (define r 20) (* r r))"] ::constcl::global_env]
} -output "(define f (lambda () (define r 20) (* r r)))\n"

test eval-8.3 {define} -body {
    w [::constcl::rewrite-define [p "(define (list-find-key lst key)\n(lfk lst key 0))"] ::constcl::global_env]
} -output "(define list-find-key (lambda (lst key) (lfk lst key 0)))\n"

test eval-8.4 {define} -body {
    w [::constcl::rewrite-define [p "(define (f . r) (* r r))"] ::constcl::global_env]
} -output "(define f (lambda r (* r r)))\n"


cleanupTests
return
