
package require tcltest
namespace import -force tcltest::*
source ../constcl.tcl

test macros-9.0 {expand for/list macro} -body {
    pxw {(for/list ([i (quote (1 2 3))]) (* i i))}
} -output "(list (let ((i 1)) (* i i)) (let ((i 2)) (* i i)) (let ((i 3)) (* i i)))\n"

test macros-9.1 {run for/list macro} -body {
    pew {(for/list ([i (quote (1 2 3))]) (* i i))}
} -output "(1 4 9)\n"

test macros-9.2 {expand for/list macro} -body {
    pxw {(for/list ([c "abc"]) (char-upcase c))}
} -output "(list (let ((c #\\a)) (char-upcase c)) (let ((c #\\b)) (char-upcase c)) (let ((c #\\c)) (char-upcase c)))\n"

test macros-9.3 {run for/list macro} -body {
    pew {(for/list ([c "abc"]) (char-upcase c))}
} -output "(#\\A #\\B #\\C)\n"

test macros-9.4 {expand for/list macro} -body {
    pxw {(for/list ([i (in-range 1 4)]) (* i i))}
} -output "(list (let ((i 1)) (* i i)) (let ((i 2)) (* i i)) (let ((i 3)) (* i i)))\n"

test macros-9.5 {run for/list macro} -body {
    pew {(for/list ([i (in-range 1 4)]) (* i i))}
} -output "(1 4 9)\n"

test macros-9.6 {expand for/list macro} -body {
    pxw {(for/list ([i (in-range 1 4)] [j "abc"]) (list i j))}
} -output "(list (let ((i 1) (j #\\a)) (list i j)) (let ((i 2) (j #\\b)) (list i j)) (let ((i 3) (j #\\c)) (list i j)))\n"

test macros-9.7 {run for/list macro} -body {
    pew {(for/list ([i (in-range 1 4)] [j "abc"]) (list i j))}
} -output "((1 #\\a) (2 #\\b) (3 #\\c))\n"


cleanupTests
return
